import{j as t,E as x,a as j,u as y,r as v,R as b,I as m,S as w,s as r}from"./index-x4Ma9uTE.js";import{C as I,u as N}from"./index.esm-BvGZI0Og.js";import{B as S}from"./Button-CBV9p-Sf.js";function C({label:e,name:s,control:c,defaultValue:u=""}){return t.jsxs("div",{className:"w-full",children:[e&&t.jsx("label",{className:"inline-block mb-1 pl-1",children:e}),t.jsx(I,{name:s||"content",control:c,render:({field:{onChange:d}})=>t.jsx(x,{initialValue:u,apiKey:"a4x4lsc3l86z2o9rvg8al9w8zo49ek00faype2ial6kcf1en",init:{branding:!1,height:500,menubar:!0,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","code","help","wordcount"],toolbar:"undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"},onEditorChange:d})})]})}function T({post:e}){const{register:s,handleSubmit:c,watch:u,control:d,setValue:i}=N(),g=j(),h=y(a=>a.auth.userData),p=async a=>{if(e){const l=a.image[0]?await r.uploadImageToCloudinary(a.image[0]):null;if(l){const f=r.getPublicIdFromUrl(e.featuredImage);f&&await r.deleteImageFromCloudinary(f)}const n=await r.updatePost(e.$id,{...a,featuredImage:l?JSON.stringify(l):e.featuredImage});n&&g(`/post/${n.$id}`)}else{const l=await r.uploadImageToCloudinary(a.image[0]);if(l){const n=await r.createPost({...a,featuredImage:JSON.stringify(l),userId:h.$id});n&&g(`/post/${n.$id}`)}}},o=v.useCallback(a=>{if(a&&typeof a=="string")return a.trim().toLowerCase().replace(/[^a-zA-Z\d\s]+/g,"-").replace(/\s/g,"-")},[]);return b.useEffect(()=>{e&&(i("title",e.title||""),i("slug",o(e.title||""),{shouldValidate:!0}),i("content",e.content||""),i("status",e.status||"active"))},[e]),b.useEffect(()=>{u((a,{name:l})=>{l==="title"&&i("slug",o(a.title),{shouldValidate:!0})})},[u,o,i]),t.jsxs("form",{onSubmit:c(p),className:"flex flex-wrap justify-center bg-gray-200 rounded-lg p-2 pb-4 shadow-lg",children:[t.jsxs("div",{className:"w-2/3 px-2",children:[t.jsx(m,{label:"Title",placeholder:"Title",className:"mb-4",...s("title",{required:!0})}),t.jsx(m,{label:"Slug :",placeholder:"Slug",className:"mb-4",...s("slug",{required:!0}),onInput:a=>{i("slug",o(a.currentTarget.value),{shouldValidate:!0})}}),t.jsx(C,{label:"content:",name:"content",control:d,defaultValue:e?e.content:""})]}),t.jsxs("div",{className:"w-1/3 px-2",children:[t.jsx(m,{label:"Featured Image",type:"file",className:"mb-4",accept:"image/png, image/jpg, image/jpeg",...s("image",{required:!e})}),e&&t.jsx("div",{className:"w-full mb-4",children:t.jsx("img",{src:e.featuredImage.secure_url||e.featuredImage,alt:e.title,className:"rounded-lg"})}),t.jsx(w,{options:["active","inactive"],label:"status",className:"mb-4",...s("status",{required:!0})}),t.jsx(S,{type:"submit",bgColor:e?"bg-green-500":void 0,className:"w-full hover:opacity-80 transition duration-200",children:e?"Update":"Submit"})]})]})}export{T as P};
